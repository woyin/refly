# Week1 Divergent Pilot å…¨é“¾è·¯æµ‹è¯•æŒ‡å—

## ğŸ¯ æµ‹è¯•ç›®æ ‡

éªŒè¯Week1å®ç°çš„**åŠ¨æ€å‘æ•£-æ±‡èšï¼ˆ"æ€»åˆ†æ€»"ï¼‰**pilotç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œç¡®ä¿æ•´ä¸ªæ¶æ„æ­£å¸¸å·¥ä½œã€‚

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

### å·²å®ç°çš„æ ¸å¿ƒåŠŸèƒ½

1. **DivergentSessionåˆ›å»º** - æ”¯æŒå‘æ•£æ¨¡å¼çš„pilotä¼šè¯
2. **LLMé©±åŠ¨çš„ä»»åŠ¡ç”Ÿæˆ** - æ™ºèƒ½åˆ†è§£ç”¨æˆ·éœ€æ±‚ä¸ºå¹¶è¡Œå­ä»»åŠ¡  
3. **å¹¶è¡Œä»»åŠ¡æ‰§è¡Œ** - åŒæ—¶æ‰§è¡Œå¤šä¸ªå­ä»»åŠ¡ï¼ˆWeek1ä½¿ç”¨mockæ‰§è¡Œï¼‰
4. **ç»“æœæ±‡èš** - æ™ºèƒ½æ±‡æ€»å¹¶è¡Œä»»åŠ¡ç»“æœ
5. **å®Œæˆåº¦è¯„ä¼°** - è¯„ä¼°å½“å‰é˜¶æ®µå®Œæˆåº¦ï¼Œå†³å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨
6. **APIæ¥å£** - å®Œæ•´çš„REST APIæ”¯æŒå‰ç«¯è°ƒç”¨

### æŠ€æœ¯æ¶æ„

- **DivergentEngine**: LLMé©±åŠ¨çš„æ ¸å¿ƒç®—æ³•å¼•æ“
- **DivergentOrchestrator**: ä¸»æ§åˆ¶å™¨ï¼Œç®¡ç†æ•´ä¸ª"æ€»åˆ†æ€»"å¾ªç¯
- **PilotDivergentService**: ä¼šè¯ç®¡ç†æœåŠ¡
- **API Controller**: RESTfulæ¥å£å±‚
- **æ•°æ®åº“æ‰©å±•**: æ”¯æŒå‘æ•£æ¨¡å¼çš„æ•°æ®æ¨¡å‹

## ğŸš€ ç¯å¢ƒå‡†å¤‡

### 1. å¯åŠ¨åç«¯APIæœåŠ¡

```bash
cd /Users/qiyuan/Documents/Code/anthhub/ai/refly-team/refly-origin/apps/api

# æ„å»ºå¹¶å¯åŠ¨APIæœåŠ¡å™¨
npm run build:fast && node dist/main.js

# éªŒè¯æœåŠ¡å™¨å¯åŠ¨
curl http://localhost:5800/health  # å¯èƒ½404ï¼Œæ­£å¸¸
```

### 2. ç”¨æˆ·è®¤è¯è®¾ç½®

```bash
# åˆ›å»ºæµ‹è¯•ç”¨æˆ·å¹¶è·å–cookie
curl -X POST http://localhost:5800/v1/auth/email/signup \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "testpassword"
  }'

# ç™»å½•è·å–è®¤è¯cookie
curl -X POST http://localhost:5800/v1/auth/email/login \
  -H "Content-Type: application/json" \
  -c cookies.txt \
  -d '{
    "email": "test@example.com",
    "password": "testpassword"
  }'
```

## ğŸ§ª æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•

### Test Case 1: åˆ›å»ºå‘æ•£ä¼šè¯

**æµ‹è¯•ç›®æ ‡**: éªŒè¯å‘æ•£ä¼šè¯åˆ›å»ºåŠŸèƒ½

```bash
curl -X POST http://localhost:5800/v1/pilot/divergent/session/new \
  -H "Content-Type: application/json" \
  -b cookies.txt \
  -d '{
    "mode": "divergent",
    "prompt": "å¸®æˆ‘åˆ†æäººå·¥æ™ºèƒ½çš„å‘å±•è¶‹åŠ¿",
    "maxDivergence": 4,
    "maxDepth": 3
  }'
```

**é¢„æœŸå“åº”**:
```json
{
  "success": true,
  "data": {
    "sessionId": "ps-xxxxxxxxxxxx",
    "status": "init",
    "mode": "divergent"
  }
}
```

**é¢„æœŸæ•°æ®åº“è®°å½•**:
- `PilotSession` è¡¨æ–°å¢1æ¡è®°å½•
- `mode` = "divergent"
- `maxDivergence` = 4
- `maxDepth` = 3
- `currentDepth` = 0
- `input` = JSONå­—ç¬¦ä¸²åŒ…å«ç”¨æˆ·prompt

### Test Case 2: æŸ¥è¯¢ä¼šè¯çŠ¶æ€

**æµ‹è¯•ç›®æ ‡**: éªŒè¯ä¼šè¯çŠ¶æ€æŸ¥è¯¢å’Œè¿›åº¦è·Ÿè¸ª

```bash
# ä½¿ç”¨ä¸Šä¸€æ­¥è¿”å›çš„sessionId
curl -X GET "http://localhost:5800/v1/pilot/divergent/session/status?sessionId=ps-xxxxxxxxxxxx" \
  -H "Content-Type: application/json" \
  -b cookies.txt
```

**é¢„æœŸå“åº”**:
```json
{
  "success": true,
  "data": {
    "sessionId": "ps-xxxxxxxxxxxx",
    "status": "executing|completed",
    "mode": "divergent",
    "currentDepth": 0-3,
    "maxDepth": 3,
    "maxDivergence": 4,
    "progress": {
      "totalSteps": 0,
      "executionSteps": 0,
      "summarySteps": 0,
      "completedSteps": 0
    },
    "title": "å¸®æˆ‘åˆ†æäººå·¥æ™ºèƒ½çš„å‘å±•è¶‹åŠ¿",
    "createdAt": "2024-08-08T...",
    "updatedAt": "2024-08-08T..."
  }
}
```

**é¢„æœŸæ•°æ®åº“å˜åŒ–**:
- ç³»ç»Ÿè‡ªåŠ¨åœ¨åå°æ‰§è¡Œå‘æ•£-æ±‡èšæµç¨‹
- `PilotStep` è¡¨ä¼šæ–°å¢å¤šæ¡è®°å½•ï¼š
  - æ‰§è¡Œæ­¥éª¤ï¼ˆnodeType="execution"ï¼‰
  - æ±‡èšæ­¥éª¤ï¼ˆnodeType="summary"ï¼‰
- `status` å­—æ®µå˜åŒ–ï¼šinit â†’ executing â†’ completed

### Test Case 3: ä¼šè¯åˆ—è¡¨æŸ¥è¯¢

**æµ‹è¯•ç›®æ ‡**: éªŒè¯ç”¨æˆ·ä¼šè¯åˆ—è¡¨åŠŸèƒ½

```bash
curl -X GET "http://localhost:5800/v1/pilot/divergent/sessions?limit=5" \
  -H "Content-Type: application/json" \
  -b cookies.txt
```

**é¢„æœŸå“åº”**:
```json
{
  "success": true,
  "data": [
    {
      "sessionId": "ps-xxxxxxxxxxxx",
      "title": "å¸®æˆ‘åˆ†æäººå·¥æ™ºèƒ½çš„å‘å±•è¶‹åŠ¿",
      "status": "completed",
      "mode": "divergent",
      "currentDepth": 1-3,
      "maxDepth": 3,
      "stepCount": 0,
      "createdAt": "2024-08-08T...",
      "updatedAt": "2024-08-08T..."
    }
  ]
}
```

## ğŸ“Š æ•°æ®åº“éªŒè¯

### æ£€æŸ¥PilotSessionè¡¨

```sql
-- æŸ¥çœ‹å‘æ•£ä¼šè¯è®°å½•
SELECT 
  sessionId,
  mode,
  maxDivergence,
  maxDepth,
  currentDepth,
  title,
  status,
  createdAt
FROM PilotSession 
WHERE mode = 'divergent' 
ORDER BY createdAt DESC 
LIMIT 5;
```

### æ£€æŸ¥PilotStepè¡¨

```sql
-- æŸ¥çœ‹æ­¥éª¤æ‰§è¡Œè®°å½•
SELECT 
  stepId,
  sessionId,
  name,
  skillName,
  nodeType,
  depth,
  status,
  createdAt
FROM PilotStep 
WHERE sessionId = 'ps-xxxxxxxxxxxx'
ORDER BY createdAt ASC;
```

**é¢„æœŸæ­¥éª¤ç±»å‹**:
- `nodeType = "execution"`: å¹¶è¡Œæ‰§è¡Œçš„å­ä»»åŠ¡
- `nodeType = "summary"`: æ±‡èšæ€»ç»“æ­¥éª¤
- `skillName`: webSearch, commonQnA, librarySearchç­‰
- `depth`: 0-3ï¼Œè¡¨ç¤ºå‘æ•£æ·±åº¦

## ğŸ¯ æ ¸å¿ƒé€»è¾‘éªŒè¯ç‚¹

### 1. LLMé©±åŠ¨çš„ä»»åŠ¡ç”Ÿæˆ
- âœ… ç³»ç»Ÿèƒ½å¤Ÿæ ¹æ®ç”¨æˆ·promptæ™ºèƒ½ç”Ÿæˆå¤šä¸ªå¹¶è¡Œå­ä»»åŠ¡
- âœ… ä»»åŠ¡æ•°é‡ä¸è¶…è¿‡maxDivergenceé™åˆ¶
- âœ… æ¯ä¸ªä»»åŠ¡æœ‰æ˜ç¡®çš„æŠ€èƒ½ç±»å‹å’Œå‚æ•°

### 2. å¹¶è¡Œæ‰§è¡Œæœºåˆ¶
- âœ… å¤šä¸ªå­ä»»åŠ¡åŒæ—¶æ‰§è¡Œï¼ˆWeek1ä½¿ç”¨mockç»“æœï¼‰
- âœ… ç³»ç»Ÿèƒ½å¤Ÿå¤„ç†éƒ¨åˆ†ä»»åŠ¡å¤±è´¥çš„æƒ…å†µ
- âœ… æ‰€æœ‰ä»»åŠ¡å®Œæˆåè§¦å‘æ±‡èš

### 3. æ™ºèƒ½æ±‡èš
- âœ… ç³»ç»Ÿèƒ½å¤Ÿå°†å¤šä¸ªä»»åŠ¡ç»“æœæ™ºèƒ½æ±‡æ€»
- âœ… ç”Ÿæˆæœ‰æ„ä¹‰çš„é˜¶æ®µæ€§æ€»ç»“
- âœ… è¯„ä¼°å½“å‰å®Œæˆåº¦

### 4. å®Œæˆåº¦è¯„ä¼°
- âœ… ç³»ç»Ÿèƒ½å¤Ÿåˆ¤æ–­æ˜¯å¦éœ€è¦è¿›ä¸€æ­¥å‘æ•£
- âœ… è¾¾åˆ°90%å®Œæˆåº¦æ—¶ç”Ÿæˆæœ€ç»ˆè¾“å‡º
- âœ… è¾¾åˆ°æœ€å¤§æ·±åº¦æ—¶å¼ºåˆ¶è¾“å‡º

### 5. æ•°æ®ä¸€è‡´æ€§
- âœ… ä¼šè¯çŠ¶æ€æ­£ç¡®æ›´æ–°
- âœ… æ­¥éª¤è®°å½•å®Œæ•´ä¿å­˜
- âœ… æ·±åº¦å’Œå±‚çº§å…³ç³»æ­£ç¡®

## ğŸ” é«˜çº§æµ‹è¯•åœºæ™¯

### åœºæ™¯1: å¤šè½®å‘æ•£æµ‹è¯•

```bash
# åˆ›å»ºéœ€è¦å¤šè½®å‘æ•£çš„å¤æ‚ä»»åŠ¡
curl -X POST http://localhost:5800/v1/pilot/divergent/session/new \
  -H "Content-Type: application/json" \
  -b cookies.txt \
  -d '{
    "mode": "divergent",
    "prompt": "ä¸ºä¸€å®¶åˆåˆ›å…¬å¸åˆ¶å®šå®Œæ•´çš„AIäº§å“æˆ˜ç•¥ï¼ŒåŒ…æ‹¬å¸‚åœºåˆ†æã€æŠ€æœ¯é€‰å‹ã€å•†ä¸šæ¨¡å¼å’Œå®æ–½è·¯çº¿å›¾",
    "maxDivergence": 6,
    "maxDepth": 4
  }'
```

**é¢„æœŸç»“æœ**: ç³»ç»Ÿè¿›è¡Œ3-4è½®å‘æ•£-æ±‡èšï¼Œç”Ÿæˆè¯¦ç»†çš„æˆ˜ç•¥åˆ†æ

### åœºæ™¯2: å‚æ•°è¾¹ç•Œæµ‹è¯•

```bash
# æµ‹è¯•æœ€å°å‚æ•°
curl -X POST http://localhost:5800/v1/pilot/divergent/session/new \
  -H "Content-Type: application/json" \
  -b cookies.txt \
  -d '{
    "mode": "divergent",
    "prompt": "ç®€å•é—®é¢˜æµ‹è¯•",
    "maxDivergence": 1,
    "maxDepth": 1
  }'
```

**é¢„æœŸç»“æœ**: ç³»ç»Ÿå¿«é€Ÿå®Œæˆï¼Œåªè¿›è¡Œ1è½®å‘æ•£

### åœºæ™¯3: å¹¶å‘æµ‹è¯•

```bash
# åŒæ—¶åˆ›å»ºå¤šä¸ªä¼šè¯
for i in {1..3}; do
  curl -X POST http://localhost:5800/v1/pilot/divergent/session/new \
    -H "Content-Type: application/json" \
    -b cookies.txt \
    -d "{
      \"mode\": \"divergent\",
      \"prompt\": \"æµ‹è¯•ä¼šè¯ $i\",
      \"maxDivergence\": 3,
      \"maxDepth\": 2
    }" &
done
wait
```

**é¢„æœŸç»“æœ**: æ‰€æœ‰ä¼šè¯éƒ½èƒ½æ­£å¸¸åˆ›å»ºå’Œæ‰§è¡Œ

## ğŸ“‹ éªŒæ”¶æ ‡å‡†

### âœ… åŸºç¡€åŠŸèƒ½ (å¿…é¡»é€šè¿‡)

- [ ] APIæœåŠ¡å™¨æ­£å¸¸å¯åŠ¨ï¼Œç«¯å£5800å¯è®¿é—®
- [ ] ç”¨æˆ·è®¤è¯æµç¨‹æ­£å¸¸
- [ ] å‘æ•£ä¼šè¯åˆ›å»ºæˆåŠŸï¼Œè¿”å›æ­£ç¡®çš„sessionId
- [ ] ä¼šè¯çŠ¶æ€æŸ¥è¯¢è¿”å›å®Œæ•´ä¿¡æ¯
- [ ] ä¼šè¯åˆ—è¡¨æŸ¥è¯¢æ­£å¸¸
- [ ] æ•°æ®åº“ä¸­æ­£ç¡®ä¿å­˜ä¼šè¯å’Œæ­¥éª¤è®°å½•

### âœ… æ ¸å¿ƒé€»è¾‘ (å¿…é¡»é€šè¿‡)

- [ ] LLMèƒ½å¤Ÿæ ¹æ®ç”¨æˆ·promptç”Ÿæˆåˆç†çš„å­ä»»åŠ¡
- [ ] ç³»ç»ŸæŒ‰ç…§"æ€»åˆ†æ€»"æ¨¡å¼æ‰§è¡Œ
- [ ] æ±‡èšæ­¥éª¤èƒ½å¤Ÿäº§ç”Ÿæœ‰æ„ä¹‰çš„æ€»ç»“
- [ ] å®Œæˆåº¦è¯„ä¼°æœºåˆ¶æ­£å¸¸å·¥ä½œ
- [ ] æœ€ç»ˆè¾“å‡ºæ­£ç¡®ç”Ÿæˆ

### âœ… é”™è¯¯å¤„ç† (å¿…é¡»é€šè¿‡)

- [ ] æ— æ•ˆsessionIdæŸ¥è¯¢è¿”å›é€‚å½“é”™è¯¯
- [ ] è®¤è¯å¤±è´¥æ—¶è¿”å›401é”™è¯¯
- [ ] å‚æ•°éªŒè¯æ­£ç¡®å·¥ä½œ

### âœ… æ€§èƒ½æŒ‡æ ‡ (åº”è¯¥é€šè¿‡)

- [ ] å•ä¸ªä¼šè¯åˆ›å»ºå“åº”æ—¶é—´ < 2ç§’
- [ ] çŠ¶æ€æŸ¥è¯¢å“åº”æ—¶é—´ < 500ms
- [ ] å¹¶å‘3ä¸ªä¼šè¯æ— å¼‚å¸¸

## ğŸš¨ å·²çŸ¥é™åˆ¶ (Week1)

1. **æŠ€èƒ½æ‰§è¡Œ**: å½“å‰ä½¿ç”¨mockç»“æœï¼ŒWeek2å°†é›†æˆçœŸå®æŠ€èƒ½æœåŠ¡
2. **Canvasé›†æˆ**: å‰ç«¯å¯è§†åŒ–æœªåœ¨Week1å®ç°
3. **æ€§èƒ½ä¼˜åŒ–**: æœªè¿›è¡Œæ€§èƒ½è°ƒä¼˜
4. **é”™è¯¯æ¢å¤**: åŸºç¡€é”™è¯¯å¤„ç†ï¼Œæ— é‡è¯•æœºåˆ¶

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **APIæœåŠ¡å™¨å¯åŠ¨å¤±è´¥**
   - æ£€æŸ¥ç«¯å£5800æ˜¯å¦è¢«å ç”¨
   - ç¡®è®¤ç¯å¢ƒå˜é‡æ­£ç¡®è®¾ç½®
   - æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—

2. **è®¤è¯å¤±è´¥**
   - ç¡®è®¤ç”¨æˆ·å·²æ­£ç¡®åˆ›å»º
   - æ£€æŸ¥cookies.txtæ–‡ä»¶ç”Ÿæˆ
   - éªŒè¯cookieåœ¨è¯·æ±‚ä¸­æ­£ç¡®ä¼ é€’

3. **ä¼šè¯åˆ›å»ºå¤±è´¥**
   - æ£€æŸ¥è¯·æ±‚JSONæ ¼å¼
   - ç¡®è®¤å¿…éœ€å­—æ®µéƒ½å·²æä¾›
   - æŸ¥çœ‹APIæœåŠ¡å™¨é”™è¯¯æ—¥å¿—

4. **æ•°æ®åº“è¿æ¥é—®é¢˜**
   - ç¡®è®¤.envæ–‡ä»¶ä¸­æ•°æ®åº“é…ç½®æ­£ç¡®
   - æ£€æŸ¥æ•°æ®åº“æœåŠ¡çŠ¶æ€
   - éªŒè¯Prismaè¿ç§»å·²æ‰§è¡Œ

### è°ƒè¯•å‘½ä»¤

```bash
# æŸ¥çœ‹APIæœåŠ¡å™¨æ—¥å¿—
tail -f /path/to/api/logs

# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :5800

# éªŒè¯æ•°æ®åº“è¿æ¥
cd apps/api && npx prisma db pull

# è¿è¡Œå•å…ƒæµ‹è¯•
npm test -- --testPathPattern=divergent
```

## ğŸ“ˆ æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

```markdown
## Week1 æµ‹è¯•æŠ¥å‘Š

**æµ‹è¯•æ—¶é—´**: 2024-08-08
**æµ‹è¯•äººå‘˜**: [å§“å]
**æµ‹è¯•ç¯å¢ƒ**: [å¼€å‘/æµ‹è¯•]

### æµ‹è¯•ç»“æœæ¦‚è§ˆ
- âœ… åŸºç¡€åŠŸèƒ½: [é€šè¿‡æ•°]/[æ€»æ•°]
- âœ… æ ¸å¿ƒé€»è¾‘: [é€šè¿‡æ•°]/[æ€»æ•°]  
- âœ… é”™è¯¯å¤„ç†: [é€šè¿‡æ•°]/[æ€»æ•°]
- âœ… æ€§èƒ½æŒ‡æ ‡: [é€šè¿‡æ•°]/[æ€»æ•°]

### è¯¦ç»†æµ‹è¯•è®°å½•
1. **ä¼šè¯åˆ›å»ºæµ‹è¯•**: âœ…/âŒ [å¤‡æ³¨]
2. **çŠ¶æ€æŸ¥è¯¢æµ‹è¯•**: âœ…/âŒ [å¤‡æ³¨]
3. **åˆ—è¡¨æŸ¥è¯¢æµ‹è¯•**: âœ…/âŒ [å¤‡æ³¨]
...

### å‘ç°çš„é—®é¢˜
1. [é—®é¢˜æè¿°] - [ä¸¥é‡ç¨‹åº¦] - [çŠ¶æ€]

### å»ºè®®
1. [æ”¹è¿›å»ºè®®]

### æ€»ä½“è¯„ä»·
Week1çš„å‘æ•£pilotç³»ç»Ÿ[è¾¾åˆ°/æœªè¾¾åˆ°]é¢„æœŸåŠŸèƒ½è¦æ±‚...
```

---

**ğŸ‰ å®ŒæˆWeek1å…¨é“¾è·¯æµ‹è¯•åï¼Œç³»ç»Ÿå°†å…·å¤‡å®Œæ•´çš„åŠ¨æ€å‘æ•£-æ±‡èšèƒ½åŠ›ï¼Œä¸ºWeek2çš„å‰ç«¯é›†æˆå’ŒçœŸå®æŠ€èƒ½æ‰§è¡Œå¥ å®šåšå®åŸºç¡€ï¼**
